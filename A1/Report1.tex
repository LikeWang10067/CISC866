\documentclass{article}
\usepackage{graphicx, listings, xcolor, subcaption, hyperref}
\usepackage[letterpaper,top=1cm,bottom=2cm,left=1cm,right=1cm,marginparwidth=1cm]{geometry}

\lstset{
  basicstyle=\ttfamily\footnotesize,
  keywordstyle=\color{blue},
  stringstyle=\color{red},
  commentstyle=\color{gray},
  breaklines=true,
  showstringspaces=false,
  backgroundcolor=\color{gray!10}
}

\title{CISC866 Lab Report}
\author{Like Wang}

\begin{document}

\maketitle

\section{Encryption Mode: ECB vs. CBC}

\subsection{Display both encrypted image files}

\textit{Note: I chose to use the following method to get rid of the header issue:}
\begin{lstlisting}[language=Python]
    $ head -c 54 original1.bmp > header
    $ tail -c +55 encrypted1.bmp > body
    $ cat header body > new1.bmp
\end{lstlisting}
\textbf{Encryption command for ECB mode} (Note: iv not used by this cipher):
\begin{lstlisting}[language=Python]
$ openssl enc -aes-128-ecb -e -in pic_original1.bmp -out pic_1_ecb_enc.bmp -K 00112233445566778889aabbccddeeff
$ openssl enc -aes-128-ecb -e -in pic_original2.bmp -out pic_2_ecb_enc.bmp -K 00112233445566778889aabbccddeeff
\end{lstlisting}
Picture look like this:
\begin{figure}[h]
    \centering
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[height=3cm]{images/pic_1_ecb.png}
        \caption{Encrypted pic original1.bmp}
    \end{subfigure}
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[height=3cm]{images/pic_2_ecb.png}
        \caption{Encrypted pic original2.bmp}
    \end{subfigure}
    \caption{ECB Mode Encrypted Images}
\end{figure}
\textbf{Encryption command for CBC mode}:
\begin{lstlisting}[language=Python]
$ openssl enc -aes-128-cbc -e -in pic_original1.bmp -out pic_1_cbc_enc.bmp -K 00112233445566778889aabbccddeeff -iv 0102030405060708090a0b0c0d0e0f10
$ openssl enc -aes-128-cbc -e -in pic_original2.bmp -out pic_2_cbc_enc.bmp -K 00112233445566778889aabbccddeeff -iv 0102030405060708090a0b0c0d0e0f10
\end{lstlisting}
Picture look like this:
\begin{figure}[h]
    \centering
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[height=3cm]{images/pic_1_cbc.png}
        \caption{Encrypted pic original1.bmp}
    \end{subfigure}
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[height=3cm]{images/pic_2_cbc.png}
        \caption{Encrypted pic original2.bmp}
    \end{subfigure}
    \caption{CBC Mode Encrypted Images}
\end{figure}
\subsection{Explain my observations}
\begin{itemize}
  \item \textbf{ECB mode} is kind of like a invalid encryption for images, because it reveals patterns in the original image. Even though the colors are changed, the shapes and outlines of objects in the image are still visible.
  \item \textbf{CBC mode} is a much better encryption method, at least from the encrypted cbc images, I can't really tell what the original image looks like.
\end{itemize}
Digging on the reason why, I found that: ECB is weak encryption for images because it's encrypted block wise, meaning that identical plaintext blocks are encrypted into identical ciphertext blocks, while CBC mode uses an initialization vector (IV) and chains the encryption of each block to the previous one, which helps to obscure patterns in the original image.\\
Check the following references for detailed information:\\
\url{https://pycryptodome.readthedocs.io/en/latest/src/cipher/classic.html#ecb-mode}\\
\url{https://pycryptodome.readthedocs.io/en/latest/src/cipher/classic.html#cbc-mode}\\
\url{https://www.highgo.ca/2019/08/08/the-difference-in-five-modes-in-the-aes-encryption-algorithm/}

\subsection{Describe the visual differences}
For me, the original image looks very simmilar, but, to me, I first noticed that original1.bmp has a bigger file size, then, I tried to zoom both picture, and noticed that original1.bmp has a vector background, meaning that when I zoom in, the background is still clear.\\
Therefore, after the encryption, encrypted1.bmp still shows grid-like patterns in the background, while encrypted2.bmp has a more uniform background.

\end{document}